# Описание
Данный проект выполнен согласно тестовому заданию, выданному "Полимедика". Задание заключается в построении базы данных университета и ее использовании с помощью REST API интерфейса, реализованного с использованием FastAPI.


# Установка и запуск
## Необходимые компоненты
Для запуска данного проекта потребуется:
- ОС на базе Linux
- Docker
- Python 3.6+


## Docker
Рекомендуемым способом запуска является Docker Compose. Для запуска через Docker необходимо сначала определить следующие переменные окружения:
```
POSTGRES_DB=<имя базы данных>
POSTGRES_USER=<имя пользователя базы данных>
POSTGRES_PASSWORD=<пароль>
```

Пример:

```
POSTGRES_DB=university
POSTGRES_USER=testuser
POSTGRES_PASSWORD=testuser
```

При первом запуске значения можно выбрать произвольные, так как на их основе создастся новая база данных. Далее, будет необходимо использовать эти данные.

Для запуска проекта можно воспользоваться следующей командой (выполняя ее из корневой папки репозитория):
```bash
export POSTGRES_DB=university
export POSTGRES_USER=testuser
export POSTGRES_PASSWORD=testuser
docker compose up --abort-on-container-exit
```

Можно также вынести переменные окружения в отдельный файл (например, `.env`) и указать его в качестве аргумента:
```bash
docker compose --env-file=./.env up --abort-on-container-exit
```

Для исполнения приложения в фоновом режиме можно воспользоваться флагом `-d` (detached):
```bash
docker compose --env-file=./.en up -d --abort-on-container-exit
```

Для завершения работы проекта воспользуйтесь следующей командой:
```bash
docker compose down
```


### Тесты
Для исполнения тестов воспользуйтесь конфигурацией `docker-compose.test.yml`, указав файл в качестве аргумента:
```bash
docker compose -f docker-compose.test.yml --env-file=./.env up --abort-on-container-exit
```


## Ручной запуск
### PostgreSQL
Для установки PostgreSQL следуйте официальной инструкции, расположенной на официальном сайте:

https://wiki.postgresql.org/wiki/Detailed_installation_guides


### Python
Библиотеки Python, которые требуются для запуска приложения, перечислены в файле `requirements.txt`. Установить их можно с помощью встроенного менеджера пакетов `pip` (перед этим создав виртуальное окружение `venv`):
```bash
python -m venv venv
source venv/bin/activate
python -m pip install -r requirements.txt
```


### Запуск
После завершения установки требуемых компонентов и зависимостей, приложение можно запустить с помощью `uvicorn` (устанавливается как библиотека Python и указана в `requirements.txt`, в результате чего никаких дополнительных действий для запуска не требуется):
```bash
uvicorn university.apps.fastapi_app.main:app --host 127.0.0.1 --port 8000
```


# База данных
Согласно заданию, база данных состоит из 15 сущностей:
- Студент
- Преподаватель
- Курс
- Группа
- Отделение
- Оценка
- Расписание
- Здание
- Аудитория
- Семестр
- Факультет
- Экзамен
- Задание для самостоятельной работы
- Программа курса
- Учебный план


# База данных
## Сущности
### `Professors`
#### Описание
Таблица преподавателей. Используется взаимозаменяемо с термином `teacher`.

#### Поля
- id (UUID) - Идентификатор преподавателя
- full_name (VARCHAR) - ФИО преподавателя


### `Courses`
#### Описание
Таблица курсов (учебных дисциплин, предметов).

#### Поля
- id (UUID) - Идентификатор курса
- title (VARCHAR) - Название курса


### `Faculties`
#### Описание
Таблица факультетов.

#### Поля
- id (UUID) - Идентификатор факультета
- title (VARCHAR) - Наименование факультета


### `Semesters`
#### Описание
Таблица учебных семестров.

#### Поля
- id (UUID) - Идентификатор учебного семестра
- semester_number (INTEGER) - Порядковый номер семестра
- begins_at (DATE) - Дата начала семестра
- ends_at (DATE) - Дата окончания семестра


### `Groups`
#### Описание
Таблица групп студентов. Тесно связана с факультетом и текущим семестром (группа студентов вместе обучается на одном факультете и находится на одном семестре).

#### Поля
- id (UUID) - Идентификатор группы в базе данных
- faculty_id (UUID) - Идентификатор факультета
- semester_id (UUID) - Идентификатор семестра
- code (VARCHAR) - Читаемый идентификатор (кодовое имя) группы


### `Students`
#### Описание
Таблица студентов. Непосредственно связана с группой (студент состоит в группе).

#### Поля
- id (UUID) - Идентификатор студента
- full_name (VARCHAR) - ФИО студента
- group_id (UUID) - Идентификатор группы, в которую назначен студент


### `Departments`
#### Описание
Таблица отделений (кафедр) ВУЗа. Имеет заведующего кафедрой из списка преподавателей.

#### Поля
- id (UUID) - Идентификатор кафедры
- title (VARCHAR) - Название кафедры
- head_professor_id (UUID) - Идентификатор преподавателя, заведующего кафедрой


### `Buildings`
#### Описание
Таблица зданий (корпусов).

#### Поля
- id (UUID) - Идентификатор здания
- code (VARCHAR) - Читаемое кодовое название здания


### `Classrooms`
#### Описание
Таблица аудиторий. Сопряжена со зданием (расположена в здании).

#### Поля
- id (UUID) - Идентификатор аудитории
- code (VARCHAR) - Читаемое кодовое название аудитории
- building_id (UUID) - Идентификатор здания


### `Exams`
#### Описание
Таблица экзаменов. Является финальным заданием курса (дисциплины), принимается преподавателем, сдается всей группой в определенной аудитории.

#### Поля
- id (UUID) - Идентификатор экзамена
- course_id (UUID) - Идентификатор курса (дисциплины)
- professor_id (UUID) - Идентификатор преподавателя, принимающего экзамен
- group_id (UUID) - Идентификатор группы, сдающей экзамен
- classroom_id (UUID) - Идентификатор аудитории, в которой принимается экзамен
- begins_at (TIMESTAMP WITH TIME ZONE) - Дата и время начала экзамена


### `Grades`
#### Описание
Таблица оценок. Оценивается экзамен, оценка ставится студентам индивидуально.

#### Поля
- id (UUID) - Идентификатор оценки
- student_id (UUID) - Идентификатор студента, которому выставлена оценка
- exam_id (UUID) - Идентификатор экзамена, за который выставлена оценка
- grade (INTEGER) - Выставленная оценка
- created_at (TIMESTAMP WITH TIME ZONE) - Дата и время выставления оценки


### `Schedule`
#### Описание
Таблица расписаний занятий по курсам (дисциплинам). Занятия ведутся преподавателем по определенной дисциплине в указанной аудитории.

#### Поля
- id (UUID) - Идентификатор записи в расписании
- professor_id (UUID) - Идентификатор преподавателя, ведущего занятие
- course_id (UUID) - Идентификатор курса (дисциплины), по которой ведется занятие
- classroom_id (UUID) - Идентификатор аудитории, в которой ведется занятие
- begins_at (TIMESTAMP WITH TIME ZONE) - Дата и время начала занятия
- ends_at (TIMESTAMP WITH TIME ZONE) - Дата и время окончания занятия


### `Exercises`
#### Описание
Таблица заданий для самостоятельной работы. Задания привязаны к определенной дисциплине, но не оцениваются.

#### Поля
- id (UUID) - Идентификатор самостоятельного задания
- course_id (UUID) - Идентификатор курса (дисциплины), к которой привязано задание
- content (TEXT) - Содержание задания
- created_at (TIMESTAMP WITH TIME ZONE) - Дата и время создания задания


### `Educational programs`
#### Описание
Таблица, отвечающая за обучающую программу курса (учебного года). Каждая запись описывает дисциплину в учебной программе, наименование темы, короткое описание содержания данной дисциплины, а также может содержать самостоятельное задание.

#### Поля
- id (UUID) - Идентификатор записи в обучающей программе
- course_id (UUID) - Идентификатор описываемого курса (дисциплины)
- topic (VARCHAR) - Наименование темы
- content (TEXT) - Краткое описание дисциплины
- exercise_id (UUID | NULL) - Опциональный идентификатор самостоятельной работы по теме


### `Syllabus`
#### Описание
Таблица учебного плана. Каждая дисциплина назначается группе на определенный семестр.

#### Поля
- id (UUID) - Идентификатор записи в учебном плане
- code (VARCHAR) - Читаемый код учебного плана
- group_id (UUID) - Идентификатор группы, которой назначена дисциплина
- semester_id (UUID) - Идентификатор семестра, на который назначена дисциплина
- course_id (UUID) - Назначенная дисциплина
- reserved_hours (INTEGER) - Выделенное кол-во часов на занятия по дисциплине
- note (TEXT | NULL) - Дополнительная информация, поясненние (необязательно)


# Пояснения к реализации
## Доменные модели
Доменные модели используются для предотвращения привязки к конкретной реализации ORM.

## Репозитории
Репозитории используются для управления доменными моделями (также для предотвращения зависимости от конкретной ORM). Определяет интерфейс, который позволяет хранить объекты как угодно, что значительно упрощает unit-тестирование.

## Доменные сервисы
Доменные сервисы используются для избежания непосредственного создания экземпляра доменной модели через конструктор. Реализованы только методы, которые необходимы для выполнения задания.

## Unit Of Work
Абстрагирует сессию базы данных, что также позволяет использовать данную абстракцию с разными ORM или объектами в памяти. Упрощает тестирование и хранит репозитории в одном месте.


# Примечания
- Для простоты и совместимости (например, с Django) в проекте не использовались составные ключи.
- Одно из заданий звучало следующим образом: "Выбрать всех студентов, обучающихся на курсе 'Математика'". Ввиду этого, "курс" был интерпретирован как учебная дисциплина (учебный предмет). Это так же не может быть кафедрой или факультетом, так как они обозначены отдельно.
- "Оценка за курс" была интерпретирована как оценка студента за экзамен в текущем семестре по данному курсу (дисциплине).
- Была добавлена дополнительная точка входа `GET /grades/{grade_id}` для перенаправления на нее после `POST` или `PUT` запроса.
- Маршрутов, указанных в задании, недостаточно для использования даже этих маршрутов. Таким образом, необходимо вручную добавить данные в базу. Для удобства, команды для этого были созданы заранее и сохранены в файл `./sql_test_init/seed.sql`. Добавить их можно с помощью `psql`:\
`psql -h 127.0.0.1 -U <имя пользователя> -d <имя базы данных> -f ./sql_test_init/seed.sql`
